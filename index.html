<!-- Referencias:
sets (evita tener que checar que ya este una posible lcs en un arreglo [no deja poner repetidos]):
    https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set
    https://alligator.io/js/sets-introduction/
pintar tabla con js: https://stackoverrun.com/es/q/2502072
funciones asincronas:   
    https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function
    https://es.stackoverflow.com/questions/142132/como-hacer-un-sleep-en-javascript                      
await retorna el valor de la funcion, en lugar de la promise: https://stackoverflow.com/questions/48908930/function-returns-promise-object-instead-of-value-async-await
-->
<!DOCTYPE html>
<html>

<head>

    <title>Longest Common Subsequence</title>

    <script type="text/javascript">

        function which(word1, word2, delay) {
            if (delay != 0) {
                lcs(word1, word2, delay);
            } else {
                lcsnd(word1, word2);
            }
        }

        async function lcs(word1, word2, delay) {
            document.getElementById("lcs").innerHTML = "";
            var x = word1.split('');
            var y = word2.split('');
            const matriz = new Array(x.length + 1).fill(0).map(() => new Array(y.length + 1).fill(0));
            crear(matriz, x, y, i, j, 1);
            for (var i = 0; i <= x.length; i++) {
                for (var j = 0; j <= y.length; j++) {
                    if (i == 0 || j == 0) {
                        matriz[i][j] = 0;
                    } else if (x[i - 1] == y[j - 1]) {
                        matriz[i][j] = matriz[i - 1][j - 1] + 1;
                        await sleep(delay);
                        crear(matriz, x, y, i, j, 1);
                    } else {
                        matriz[i][j] = Math.max(matriz[i - 1][j], matriz[i][j - 1]);
                        await sleep(delay);
                        crear(matriz, x, y, i, j, 0);
                    }
                }
            }
            crear(matriz, x, y, i, j, 2);
            if (matriz[x.length][y.length] != 0) {
                var s = await all_lcs(x.length, y.length, matriz, x, y, delay);
                await sleep(1000);
                document.getElementById("lcs").innerHTML = "<ul>"
                s.forEach(element => {
                    document.getElementById("lcs").innerHTML += "<li>" + element + "</li>";
                })
                document.getElementById("lcs").innerHTML += "</ul>"
            } else {
                document.getElementById("lcs").innerHTML = "¡No hay LCS!"
            }
        }

        async function all_lcs(xlength, ylength, matriz, xchar, ychar, delay) {
            var s = new Set();
            if (xlength == 0 || ylength == 0 || matriz[xlength][ylength] == 0) {
                sleep(delay);
                s.add("");
            } else {
                if (xchar[xlength - 1] == ychar[ylength - 1]) {
                    await sleep(delay);
                    crear(matriz, xchar, ychar, xlength, ylength, 1);
                    var tmp = await all_lcs(xlength - 1, ylength - 1, matriz, xchar, ychar, delay);
                    tmp.forEach(element => {
                        s.add(element + xchar[xlength - 1])
                    })
                } else {
                    if (matriz[xlength - 1][ylength] >= matriz[xlength][ylength - 1]) {
                        await sleep(delay);
                        crear(matriz, xchar, ychar, xlength, ylength, 0);
                        s = await all_lcs(xlength - 1, ylength, matriz, xchar, ychar, delay);
                    }
                    if (matriz[xlength][ylength - 1] >= matriz[xlength - 1][ylength]) {
                        await sleep(delay);
                        crear(matriz, xchar, ychar, xlength, ylength, 0);
                        var tmp = await all_lcs(xlength, ylength - 1, matriz, xchar, ychar, delay);
                        tmp.forEach(element => {
                            s.add(element);
                        });
                    }
                }
            }
            document.getElementById("lcs").innerHTML = "<ul>"
            s.forEach(element => {
                document.getElementById("lcs").innerHTML += "<li>" + element + "</li>";
            })
            document.getElementById("lcs").innerHTML += "</ul>"
            return s;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function lcsnd(word1, word2) {
            document.getElementById("lcs").innerHTML = "";
            var x = word1.split('');
            var y = word2.split('');
            const matriz = new Array(x.length + 1).fill(0).map(() => new Array(y.length + 1).fill(0));
            for (var i = 0; i <= x.length; i++) {
                for (var j = 0; j <= y.length; j++) {
                    if (i == 0 || j == 0) {
                        matriz[i][j] = 0;
                    } else if (x[i - 1] == y[j - 1]) {
                        matriz[i][j] = matriz[i - 1][j - 1] + 1;
                    } else {
                        matriz[i][j] = Math.max(matriz[i - 1][j], matriz[i][j - 1]);
                    }
                }
            }
            crear(matriz, x, y, i, j, 2);
            if (matriz[x.length][y.length] != 0) {
                var s = all_lcsnd(x.length, y.length, matriz, x, y);
                document.getElementById("lcs").innerHTML = "<ul>"
                s.forEach(element => {
                    document.getElementById("lcs").innerHTML += "<li>" + element + "</li>";
                })
                document.getElementById("lcs").innerHTML += "</ul>"
            } else {
                document.getElementById("lcs").innerHTML = "¡No hay LCS!"
            }
        }

        function all_lcsnd(xlength, ylength, matriz, xchar, ychar) {
            var s = new Set();
            if (xlength == 0 || ylength == 0 || matriz[xlength][ylength] == 0) {
                s.add("");
            } else {
                if (xchar[xlength - 1] == ychar[ylength - 1]) {
                    var tmp = all_lcsnd(xlength - 1, ylength - 1, matriz, xchar, ychar);
                    tmp.forEach(element => {
                        s.add(element + xchar[xlength - 1])
                    })
                } else {
                    if (matriz[xlength - 1][ylength] >= matriz[xlength][ylength - 1]) {
                        s = all_lcsnd(xlength - 1, ylength, matriz, xchar, ychar);
                    }
                    if (matriz[xlength][ylength - 1] >= matriz[xlength - 1][ylength]) {
                        var tmp = all_lcsnd(xlength, ylength - 1, matriz, xchar, ychar);
                        tmp.forEach(element => {
                            s.add(element);
                        });
                    }
                }
            }
            return s;
        }

        function crear(matriz, xchar, ychar, k, r, bool) {
            var col = xchar.length;
            var filas = ychar.length;
            if (bool == 1) {
                bool = " bgcolor = green";
            } else if (bool == 0) {
                bool = " bgcolor = red";
            } else {
                bool = "";
            }
            var xword = [];
            xword.push("∅");
            for (var i = 0; i < xchar.length; i++) {
                xword.push(xchar[i]);
            }
            var yword = [];
            yword.push("∅");
            for (var i = 0; i < ychar.length; i++) {
                yword.push(ychar[i]);
            }
            var tabla = "<table white border=\"1\" width=40% style=\"background-color:whitesmoke;\">";
            tabla += "<tr align=center><td></td>";
            for (j = 0; j < col + 1; j++) {
                if (xword[j] != undefined) {
                    if (j == k) {
                        tabla += "<td" + bool + ">" + (xword[j]) + "</td>";
                    } else {
                        tabla += "<td>" + (xword[j]) + "</td>";
                    }
                }
            }
            tabla += "</tr>";
            for (i = 0; i < matriz[0].length; i++) {
                tabla += "<tr align = center>";
                if (i == r) {
                    tabla += "<td" + bool + ">" + (yword[i]) + "</td>";
                } else {
                    tabla += "<td>" + (yword[i]) + "</td>";
                }
                for (j = 0; j < matriz.length; j++) {
                    if (i == r && j == k) {
                        tabla += "<td" + bool + ">" + matriz[j][i] + "</td>";
                    } else {
                        tabla += "<td>" + matriz[j][i] + "</td>";
                    }
                }
                tabla += "</tr>";
            }
            tabla += "</table></form>";
            document.getElementById("resultado").innerHTML = tabla;
        }
    </script>

</head>

<body style="background-color:rgb(69, 123, 157);">
    <center>
        <h1 style="position: relative; left: 5%;">Longest Common Subsequence</h1>
    </center>
    <ul style="position: relative; left: 5%;">
        <li>
            Palabra 1:
            <input type="text" id="word1" value="abcdef" size="11" style="vertical-align:1px">
        </li>
        <li>
            Palabra 2:
            <input type="text" id="word2" value="abedcf" size="11" style="vertical-align:1px">
        </li>
        <br>
        <li>
            <button type="button"
                onclick='which(document.getElementById("word"+1).value, document.getElementById("word"+2).value, document.getElementById("delay").value)'>Longest
                Common Subsequence</button>
            Delay:
            <input type="text" id="delay" value="500" size="11" style="vertical-align:1px">
        </li>
    </ul>
    <br>
    <div style="position: relative; left: 10.5%; top: 20%; width: 100%; align-items: center;">
        <div id="resultado">
        </div>
        <div id="lcs"
            style="position: absolute; top: -20%;left: 50%; font-family: 'Brush Script MT', cursive; font-size: 3em;">
        </div>
    </div>
</body>

</html>